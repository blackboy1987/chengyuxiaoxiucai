"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const loader_utils_1 = __importDefault(require("loader-utils"));
const macro_1 = require("@remax/macro");
const nativeComponent_1 = require("../../../utils/nativeComponent");
const getAssets_1 = __importDefault(require("./getAssets"));
function nativeComponent(source) {
    if (this.cacheable) {
        this.cacheable();
    }
    const resourcePath = this.resourcePath;
    const { remaxOptions, api } = loader_utils_1.default.getOptions(this);
    if (!nativeComponent_1.isNativeComponent(resourcePath)) {
        return source;
    }
    const assets = getAssets_1.default(api, resourcePath, remaxOptions);
    assets.forEach(file => {
        this.addDependency(file);
    });
    const type = macro_1.registerNativeComponent(resourcePath, '', assets);
    return `import { createNativeComponent } from '@remax/runtime';
export default createNativeComponent('${type}')
`;
}
exports.default = nativeComponent;
